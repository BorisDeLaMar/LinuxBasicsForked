# Ссылки  

Будут рассмотрены **символические и жесткие ссылки** или **линки** на файлы.  
NB Ссылки поддерживаются не всеми файловыми системами.

Пусть у нас есть файл *test*, в котором просто написано "Hello".  
`stat test` - утилита stat позволяет узнать некоторую полезную информацию о файле. Например, `Inode` - конкретный узел в дереве блоков файловой системы.  
```
ln test test.hardlink
stat test.hardlink
```
Получим у нового файла  такой же `Inode` как и у оригинального файла. Теперь:
```
ln -s test test.softlink
ll
stat test.softlink
```
Уже в `ll` мы заметим нетипичное отображение, а в выводе `stat` заметим изменение `Size` и `Inode`. Бахаем:  
```
rm test
ll
```
В выводе `ll` заметим, что `.hardlink` остался без изменений, а вот .softlink будет выделен. Что это значит?? А то, что `cat test.hardlink` выведет `Hello`, а аналогичная команда для `.softlink` выдаст ошибку.  

***Почему так произошло?***  
Когда мы создали файл `test`, "Hello" было записано в пользовательские данные, а метаинформация(имя и проч) в другой блок данных - *Inode*.  
Создав `.hardlink` мы создали еще одно имя для того же пользовательского блока данных, а `.softlink` - новый файл, хранящий имя, косвенно указывающее на пользовательскую инфу файла `test`, и имеющий собственный inode.  
`rm test` - удаление метаинформации(имени test), поэтому `.softlink` перестал на него ссылаться(делал это он именно по имени `test` и про то, что у это области данных есть еще имя `test.hardlink` не знает.  
**Резюмируя,** '.hardlink' - альтернативное имя, расширение списка имен, а `.softlink` - ссылка на файл по его имени в файловой системе.  

Вернем файл, немного видоизменив его и проверим ссылки: 
```
echo "Hello world" >test
cat test.hardlink
cat test.softlink
```
Как и ожидалось, `test.hardlink` вывел `Hello`, а `test.softlink` - `Hello world`.  
## Работа с ссылками на программы  
NB Работа с `.hardlink`программ  ничем не отличается от работы с ними для обычных файлов. в отличие от работы с `.softlink`.  
Дело в том, что `open(filename, O_RDONLY);` и по хардлинку, и по софтлинку откроет исходный файл(в примере - `test`), но `.softlink` - другой файл, с другим размером и `Inode`.  
Если хотим запретить `open` переходить по ссылкам внутри файла:
```
open(filename, O_RDONLY|O_NOFOLLOW);
```
В таком случае `.softlink` не откроется, т.к. является ссылкой.  
***А если мы хотим редактировать его?***  
`man 2 open`: здесь интересует параметр `O_PATH`. С помощью этой опции можем открыть файл и получить реальный файловый дескриптор, связанные с именем именно этого файла(файловый дескриптор ссылки), и уже дальше взаимодействовать с ним перечисленными в `man` функциями: `open(filename, O_RDONLY|O_PATH);`
