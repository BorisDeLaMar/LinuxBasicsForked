# Сокеты дейтаграм. Протокол UDP  
Инструменты отладки таких программ:
+ `netstat` - при запуске без параметров (речсь про терминал), выводит открытые порты с соединениями, а также сокеты unix (это локальные сокеты,
использующиеся для взаимодействия процессов в рамках одной ОС, не требует связки с IP адресами). 
+ `netcad` или `nc` (`man nc`) - утилита, позволяющая делать произвольные TCP и UDP сервера и клиенты

## TCP сервер и клиент с помощью netcad  
*NB Будем использовать локальные адреса, поэтому не будем указывать имя хоста. Протокол TCP используется netcad по умолчанию.*  

Со стороны сервера:  
1) `nc 3000 -l` - `-l` значит listen  
Со стороны клиента (просто новую вкладку терминала открыли):  
1) `nc localhost 3000`
2) `vim data`, напишем там Hello world
3) nc localhost 3000 <data
После этого на сервере выдаст сообщение.
## UDP сервер и клиент с помощью netcad  
Со стороны сервера:  
1) `nc localhost -u 3000 -l` - `-l` значит listen  
Со стороны клиента (просто новую вкладку терминала открыли):  
1) `nc localhost 3000 -u`
2) `vim data`, напишем там Hello world
3) `nc localhost 3000 <data`

Сервер, работающий по UDP (создает сокет, пытаться читать данные из него, печатать на экран данные и завершаться):
```C
#include <stdio.h>
#include <sys/socket.h>
#include <netinet/ip.h>
#include <arpa/inet.h>

struct sockaddr_in local; /*адрес IP сети, олицетворяющая локальный адрес. Когда просто создаем сокет - это структура, состоящая из IP+port,
но чтобы ее использовать (открыть порт), нужна команда bind*/

int main(int c, char **v)
{
	int s = socket(AF_INET, SOCK_DGRAM, 0); /* Создание сокета/ AF_INET - семейство адресов IPv4,
SOCK_DGRAM - дейтаграммные протоколы (посылаются пакетами, максимальный размер которых жестко задан сконфигуророванной сетью,
нет гарантии доставки)
Последний параметр - конкретный протокол в данном семействе адресов. Используем базовый протокол, поэтому указания не требуются*/
	printf("socket=%d\n", s);

	inet_aton("127.0.0.1", &local.sin_addr); /* "127.0.0.1" - специальный адрес локального интерфейса,
который преобразовали в бинарный формат, в котором он по сети ходит*/
	local.sin_port = htons(1234); /* Установили порт сразу в формате сети, htons - host to network short.
Есть разные архитектуры хостов, разные порядки байт (big-endian, little-endian), и для того, чтобы правильно открыть порт,
надо использовать htons.
	local.sin_family = AF_NET; //семейство для структуры

	int result = bind(s, (struct sockaddr*) &local, sizeof(local));
	printf("%d\n", result);

	char buf[BUFSIZ];
	read(s, buf, BUFSIZ);
	printf("%s, bye\n", buf);
}
```
Сборка:  
```bash
gcc udp.c -o udp
./udp
```  
Далее в другом окне консоли: `nc 127.0.0.1 -u 1234`
